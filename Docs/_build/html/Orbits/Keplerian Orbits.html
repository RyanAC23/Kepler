
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Equations of motion &#8212; kepler 0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/traditional.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mercury" href="Perihelion%20shift%20of%20Mercury.html" />
    <link rel="prev" title="Notebooks" href="../Orbits.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Perihelion%20shift%20of%20Mercury.html" title="Mercury"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Orbits.html" title="Notebooks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">kepler 0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../Orbits.html" accesskey="U">Notebooks</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Equations of motion</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>

</pre></div>
</div>
<div class="section" id="equations-of-motion">
<h1>Equations of motion<a class="headerlink" href="#equations-of-motion" title="Permalink to this headline">¶</a></h1>
<p>For an inverse square attractive potential, the energy takes the form</p>
<div class="math notranslate nohighlight">
\[
E = \frac{1}{2} m v^2 - \frac{km}{r} \qquad k \equiv GM
\]</div>
<p>In the reduced mass picture,</p>
<div class="math notranslate nohighlight">
\[
r = |\vec{r_1} - \vec{r_2}| \qquad \frac{m_1 m_2}{m_1 + m_2} = \mu = m
\]</div>
<p>Since for most of the work in this notebook the larger planet’s mass (i.e., the sun) is hidden in the coupling constant <span class="math notranslate nohighlight">\(k\)</span>, I won’t make an effort to use <span class="math notranslate nohighlight">\(\mu\)</span> instead of <span class="math notranslate nohighlight">\(m\)</span>. This would be important if I was looking at three body interactions or two body orbits where the masses are comparable and the center of mass is outside of either body, but that won’t be the case here. Be aware that it could cause trouble in the future and that this code will not be completely generic.</p>
<div class="section" id="lagrangian">
<h2>Lagrangian<a class="headerlink" href="#lagrangian" title="Permalink to this headline">¶</a></h2>
<p>Though trivial up to a certain point, it’s worth refreshing myself on the construction of the problem from scratch.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
L = \frac{1}{2}m|\dot{\vec{r}}|^2 - U(r) \qquad U(r) = - \frac{km}{r} \\
\frac{1}{2}m|\dot{\vec{r}}|^2 = \frac{1}{2}m |\vec{v_x} + \vec{v_y}|^2 \\
x = r \cos \phi \qquad y = r \sin \phi \\
\dot x =  \dot r \cos \phi - \dot \phi r \sin \phi \qquad \dot y =  \dot r \sin \phi + \dot \phi r \cos \phi \\
\rightarrow L = \frac{1}{2}m(\dot r \cos \phi \hat x - \dot \phi r \sin \phi \hat x + \dot r \sin \phi \hat y + \dot \phi r \cos \phi \hat y)^2 - U(r)\\
= \frac{1}{2} (\dot \phi ^2 r ^2 + \dot r ^2 ) - U(r)
\end{split}\]</div>
<p>Because the Lagrangian depends only on the radius, the angular momentum will be conserved. Putting these through the Euler-Lagrange equations,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{\partial}{\partial t} \frac{\partial L}{\partial \dot r} = \frac{\partial L}{\partial r} \qquad \frac{\partial}{\partial t} \frac{\partial L}{\partial \dot \phi} = \frac{\partial L}{\partial \phi} = 0 \\
m \ddot r = m r \dot \phi ^2 - \frac{\partial U(r)}{\partial r} \qquad \partial_t (\dot \phi m r^2) = 0 \\
\rightarrow \dot \phi = \frac{\mathcal{l}}{mr^2}
\end{split}\]</div>
<p>The <span class="math notranslate nohighlight">\(r\)</span> equation gives us the force we could have derived from Newton’s laws, and the <span class="math notranslate nohighlight">\(\phi\)</span> equation shows us that the angular momentum is a symmetry of the system. Because of this, our orbits will be constrained to a 2D plane.</p>
</div>
</div>
<div class="section" id="effective-potential">
<h1>Effective potential<a class="headerlink" href="#effective-potential" title="Permalink to this headline">¶</a></h1>
<p>Putting these together yields the force equation</p>
<div class="math notranslate nohighlight">
\[
F_r = \underbrace{\frac{l^2}{m r^3} - \frac{\partial U(r)}{\partial r}}_{U_\text{eff}}
\]</div>
<p>Calling the angular momentum piece an effective potential <span class="math notranslate nohighlight">\(U_\text{eff}\)</span> is common, as is seeing the radial potental, the angular momentum term, and <span class="math notranslate nohighlight">\(U_\text{eff}\)</span> all plotted together for demonstration. I’ll do that below for an inverse square potential (I haven’t used a specific form of the potential in the above, aside from constraining it to depend only on r!) with <span class="math notranslate nohighlight">\(k=1\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">/</span> <span class="mi">100</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">100</span>
<span class="n">l</span> <span class="o">=</span> <span class="mf">1.3</span> <span class="o">/</span> <span class="mi">100</span>

<span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">inverse_square</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">k</span> <span class="o">/</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">angular_term</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">m</span> <span class="o">/</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">U_effective</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">angular_term</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">inverse_square</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">inverse_square</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$-k/r$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">angular_term</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$l^2/2mr^2$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">U_effective</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$U_</span><span class="si">{eff}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region slideshow={"slide_type": "slide"} -->
<p>It turns out it’s a bit tough to find good parameters to demonstrate the potential curve. The green curve is the effective potential; bound orbits are when the energy of the orbiting body is in the concave region, below the region where it would scatter (unbound orbit).</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="d-central-potential-scattering">
<h1>1D Central Potential Scattering<a class="headerlink" href="#d-central-potential-scattering" title="Permalink to this headline">¶</a></h1>
<p>The total energy is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
E = \frac{1}{2} m \dot r^2  + U_{\text{eff}} \\
\frac{\partial r}{\partial t} = \sqrt{\frac{2}{m} \big( E - U_{\text{eff}} \big)} \\
\int_0^t dt = \int_0^R \frac{dr}{\sqrt{\frac{2}{m} \big( E - U_{\text{eff}} \big)}}
\end{split}\]</div>
<p>This is where the work stops being trivial, because these integrals are hard. The time as a function of the energy and radius is also a somewhat bogus thing to solve for. Inverting this equation does not look like a fun time. The trick (which makes things easier but not necessarily EASY) is to change coordinates as follows:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial r}{\partial t} = \frac{\partial r}{\partial \phi}\frac{\partial \phi}{\partial t} =
\frac{\partial r}{\partial \phi} \frac{\mathcal l}{mr^2}
\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[
E = \frac{1}{2}\frac{\mathcal l^2}{mr^4} \bigg(\frac{\partial r}{\partial \phi}\bigg)^2 + U_{\text{eff}}
\]</div>
<div class="math notranslate nohighlight">
\[
\boxed{\int_{\phi_0}^\phi = \Delta \phi = \int_0^R \frac{dr}{r^2 \sqrt{\frac{2m}{\mathcal l^2} \big( E - U_{\text{eff}} \big)}}}
\]</div>
<!-- #endregion -->
<!-- #region slideshow={"slide_type": "slide"} -->
<p>For the inverse square problem,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Delta \phi = \int_0^R \frac{dr}{r^2 \sqrt{\frac{2m}{\mathcal l^2} \big( E + \frac{k}{r} - \frac{\mathcal l^2}{2mr^2} \big)}} \\
= \int_0^R \frac{dr}{r^2 \sqrt{\big(\frac{2mE}{l^2} + \frac{2mk}{l^2r} - \frac{1}{r^2} \big)}}\\
= - \int \frac{du}{\sqrt{\big(\frac{2mE}{l^2} + \frac{2mk u}{l^2} - u \big)}}
\end{split}\]</div>
<p>The last line comes from making the substitution <span class="math notranslate nohighlight">\(u=1/r\)</span>, <span class="math notranslate nohighlight">\(du = -1/r^2 dr\)</span>.</p>
<div class="section" id="elliptic-integral-gratis">
<h2>Elliptic integral gratis<a class="headerlink" href="#elliptic-integral-gratis" title="Permalink to this headline">¶</a></h2>
<p>This is gross. I don’t like it. I’m not good at these things. Here’s the integral:</p>
<div class="math notranslate nohighlight">
\[
\int \frac{dx}{\sqrt{\alpha + \beta x + \gamma x^2}} = \frac{1}{\sqrt{-\gamma}} \arccos \bigg( - \frac{\beta + 2 \gamma x}{\sqrt{\beta^2 - 4 \alpha \gamma}}\bigg)
\]</div>
<p>It looks like some completing the square action is going on, given the <span class="math notranslate nohighlight">\(\arccos\)</span> argument in the denominator.</p>
<p>Making the substitutions and using the integral from the table….</p>
<div class="math notranslate nohighlight">
\[\begin{split}
alpha = \frac{2mE}{l^2} \qquad \beta = \frac{2mk}{l^2} \qquad \gamma = -1 \\
\Delta \phi = \arccos\bigg(\frac{\frac{l^2 u}{2mk} - 1}{\sqrt{1 + \frac{2El^2}{mk^2}}}\bigg)\\
\end{split}\]</div>
<p>Solving for <span class="math notranslate nohighlight">\(u\)</span> and returning to <span class="math notranslate nohighlight">\(u = 1/r\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\boxed{\frac{1}{r} = \bigg(\frac{2mk}{l^2}\bigg)\bigg(1 + \sqrt{1 + \frac{2El^2}{mk^2}}\cos\Delta\phi \bigg)}
\]</div>
<p>Smart people realized that this is the equation for conic sections,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{1}{r} = C(1 + \epsilon \cos \Delta \phi ) \\
C = \bigg(\frac{2mk}{l^2}\bigg) \qquad \epsilon = \sqrt{1 + \frac{2El^2}{mk^2}}
\end{split}\]</div>
<ul class="simple">
<li><p>Physical insight to derive these damned equations #1:</p></li>
</ul>
<p><strong>At the farthest and nearest points, the velocity of the orbiting body is entirely tangential. At these points, the radial velocity is zero.</strong></p>
<div class="math notranslate nohighlight">
\[\begin{split}
E = \frac{-k}{r} + \frac{l^2}{2mr^2} \\
E + \frac{k}{r} - \frac{l^2}{2mr^2} = 0 \\
\rightarrow r = \frac{-k \pm \sqrt{k^2 + \frac{2El^2}{m}}}{2E}
\end{split}\]</div>
<p>Using the definition of<span class="math notranslate nohighlight">\(\epsilon\)</span> this is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
r = (1 \pm \epsilon) \qquad a \equiv \frac{k}{2E}\\
r_a = a(1+\epsilon) \qquad r_p = a(1-\epsilon)
\end{split}\]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$r_a$ is the radius of the orbit at apoapsis, and $r_b$ is the radius of the orbit at periapsis (when discussing orbits around our sun, these terms take on the more specific *perihelion* and *aphelion*). $a$ is the semimajor axis. Note that $r_a + r_p = 2a$.
</pre></div>
</div>
<hr class="docutils" />
<p>There’s one more thing that I need to get reasonable simulations for the objects in our solar system. Somehow I need to estimate the initial velocity. The easiest way I could figure is when the velocity is entirely in the tangential direction, at one of the apsides. In these cases we don’t need to guess, we can calculate.</p>
<p>[a picture you’ve drawn out of the system would be nice here.]</p>
<p>If <span class="math notranslate nohighlight">\(b\)</span> is the semiminor axis, we can relate the angular momentum (conserved!) at any point with that at b.</p>
<div class="math notranslate nohighlight">
\[
l_1 = l_2 \qquad m v_1 r_1 = m v_2 r_2 = m b v_2
\]</div>
<p>The mass drops out, and the relationship is an easy one. Combine this with conservation of energy between the two points:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2} v_1 ^2 - \frac{k}{r_1} = \frac{1}{2} v_2 ^2 - \frac{k}{b}
\]</div>
<p>Two things of use:
$<span class="math notranslate nohighlight">\(
r_{\text{apsis}} = a(1\pm \epsilon) \qquad b = \sqrt{r_a r_b} \rightarrow b = a\sqrt{1-\epsilon^2}
\)</span>$</p>
<p>By combining the above equations and doing a few pages of dumb messy algebra (I did it, it works!) the velocities are</p>
<div class="math notranslate nohighlight">
\[
v_a = \sqrt{
            \frac{k}{a} \frac{(1-\epsilon)}{(1+\epsilon)}
            }
      \qquad
v_p = \sqrt{
            \frac{k}{a} \frac{(1+\epsilon)}{(1-\epsilon)}
            }
\]</div>
<!-- #endregion -->
<!-- #region slideshow={"slide_type": "slide"} -->
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="gravitational-orbits-code">
<h1>Gravitational Orbits Code<a class="headerlink" href="#gravitational-orbits-code" title="Permalink to this headline">¶</a></h1>
<p>Using the above equations, everything necessary to start simulating orbits is done. There are other things to discuss, but this has been enough equations for now. Let’s break it up with the main code for the orbital routine.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Orbits</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class solving for the trajectories of central potential orbits.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">planet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate 2D trajectories in a central potential problem.</span>

<span class="sd">        parameters</span>
<span class="sd">        ---------------------</span>
<span class="sd">        k: float</span>
<span class="sd">            Gravitational coupling constant</span>
<span class="sd">        exponent: float</span>
<span class="sd">            Factor n in 1/r^n in force equation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># AU^3 / yr^2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">=</span> <span class="n">exponent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tmax</span> <span class="o">=</span> <span class="n">Tmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">planet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No planet data supplied. Using default values for Earth.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">planet</span><span class="p">(),</span> <span class="s2">&quot;x0&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">planet</span><span class="p">(),</span> <span class="s2">&quot;v0&quot;</span><span class="p">)</span>

        <span class="n">xs</span><span class="p">,</span> <span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="n">vs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Es</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">KEs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_energy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return initial conditions for IVP.&quot;&quot;&quot;</span>
        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>
        <span class="n">dq0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">q0</span><span class="p">,</span> <span class="n">dq0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ravel two arrays into one for passing into an integrator.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">dx</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn one packed array into two unpacked ones.&quot;&quot;&quot;</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">q</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dq_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the rhs of the differential equation to integrate.&quot;&quot;&quot;</span>
        <span class="n">_x</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

        <span class="c1"># Calculate r^2 with components</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">_x</span><span class="o">.</span><span class="n">imag</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">_ddx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">r2</span>

        <span class="c1"># Calculate r^2 with absolute value</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>
        <span class="n">ddx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">*</span> <span class="n">_x</span> <span class="o">/</span> <span class="n">r</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">_ddx</span><span class="p">,</span> <span class="n">ddx</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">ddx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solve for the orbital trajectories.</span>

<span class="sd">        Note that solve_ivp has issues with these orbital problems when</span>
<span class="sd">        using its adaptive step size integration methods. To ensure</span>
<span class="sd">        convergence, rtol and atol have been set here to be low enough that</span>
<span class="sd">        issues with the adaptive step size don&#39;t appear (the energy of the</span>
<span class="sd">        orbiting body does not change in systems where energy should be</span>
<span class="sd">        conserved), but also as high as possible to keep adaptive measures</span>
<span class="sd">        possible. If the energy changes for a 1/r potential, consider lowering</span>
<span class="sd">        both atol and rtol further.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span><span class="p">()</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dq_dt</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tmax</span><span class="p">],</span>
            <span class="n">q0</span><span class="p">,</span>
            <span class="n">t_eval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BDF&quot;</span><span class="p">,</span>
            <span class="n">dense_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">atol</span><span class="o">=</span><span class="mf">0.000001</span><span class="p">,</span>  <span class="c1"># to force non-adaptive step sizes</span>
            <span class="n">rtol</span><span class="o">=</span><span class="mf">0.000001</span><span class="p">,</span>
            <span class="c1"># max_step=self.dt,</span>
        <span class="p">)</span>
        <span class="n">ts</span><span class="p">,</span> <span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">dzs</span><span class="p">)</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>

        <span class="n">zs</span> <span class="o">=</span> <span class="n">zs</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dzs</span> <span class="o">=</span> <span class="n">dzs</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">zs</span><span class="p">,</span> <span class="n">dzs</span>

    <span class="k">def</span> <span class="nf">get_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the energy for a 1/r^2 orbit. Returns [E, KE] as an array.</span>

<span class="sd">        Note that this will need to be overridden or recomputed when</span>
<span class="sd">        changing \beta.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">KE</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">PE</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">KE</span> <span class="o">+</span> <span class="n">PE</span>

        <span class="c1"># return E.ravel()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E</span><span class="p">,</span> <span class="n">KE</span><span class="p">])[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>This gives us most of the necessary tools to simulate orbits for a general exponent <span class="math notranslate nohighlight">\(\beta\)</span> in a <span class="math notranslate nohighlight">\(k / r^{\beta}\)</span> force law. To be clear, in our universe (as far as we know), this exponent is <span class="math notranslate nohighlight">\(\beta = 2\)</span>. We need planetary data, which is provided below. The attributes specific to the planet of interest get pulled into the <code class="docutils literal notranslate"><span class="pre">Orbits</span></code> class when properly applied.</p>
<div class="section" id="define-celestial-objects">
<h2>Define celestial objects<a class="headerlink" href="#define-celestial-objects" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Planet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Example class for Planet objects.&quot;&quot;&quot;</span>

    <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># in AU and years</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Necessary simulation parameters for orbits.</span>

<span class="sd">        parameters</span>
<span class="sd">        -------------------------</span>
<span class="sd">        mass : float</span>
<span class="sd">            The mass of the planet.</span>
<span class="sd">        semimajor : float</span>
<span class="sd">            Length of the semimajor axis of the planet in AU.</span>
<span class="sd">        eccentricity : float</span>
<span class="sd">            A measure of the deviation from a circular orbit.</span>
<span class="sd">        x0 : complex</span>
<span class="sd">            The initial position in x + iy.</span>
<span class="sd">        v0 : complex</span>
<span class="sd">            Initial velocity in x + iy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># AU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_at_perihelion</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">velocity_at_perihelion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the velocity at the perihelion.&quot;&quot;&quot;</span>
        <span class="n">v_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">v_p</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>


<span class="k">class</span> <span class="nc">HalleysComet</span><span class="p">(</span><span class="n">Planet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object containing parameters for Halley&#39;s Comet.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Physical parameters measured in AU and years.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">=</span> <span class="mf">17.955</span>  <span class="c1"># AU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span> <span class="o">=</span> <span class="mf">0.96714</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="mi">76</span>  <span class="c1"># years</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_at_perihelion</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>
        <span class="c1">#        # self.v0 = 1j * 11.4727</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_at_perihelion</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Mercury</span><span class="p">(</span><span class="n">Planet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object containing parameters for Mercury.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Physical parameters measured in AU and years.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">=</span> <span class="mf">0.39</span>  <span class="c1"># AU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span> <span class="o">=</span> <span class="mf">0.206</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="mf">87.97</span> <span class="o">/</span> <span class="mf">365.26</span>  <span class="c1"># years</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>
        <span class="c1"># self.v0 = 0 + 2 * np.pi * np.abs(self.x0) / self.period * 1j  # v = gm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_at_perihelion</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Earth</span><span class="p">(</span><span class="n">Planet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Object containing parameters for Earth.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Physical parameters measured in AU and years.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># AU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span> <span class="o">=</span> <span class="mf">0.017</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># years</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semimajor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perihelion</span> <span class="o">+</span> <span class="mi">0</span><span class="n">j</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_at_perihelion</span><span class="p">()</span>
</pre></div>
</div>
<p>We don’t really need the planet’s mass for the problems in this notebook, since the sun is so massive that their total mass is effectively the sun’s mass and the center of mass is deep inside that star.</p>
</div>
<div class="section" id="units">
<h2>units<a class="headerlink" href="#units" title="Permalink to this headline">¶</a></h2>
<p>Let’s talk about units.</p>
<p>The orders of magnitude in astronomical work are too spread to be smart for computational work with numbers stored in floats and whatnot. <span class="math notranslate nohighlight">\(10^{27}\text{kg}\)</span> doesn’t play well with the gravitational constant <span class="math notranslate nohighlight">\(G = 6.673 \times 10^{-11}\text{N/kg m}^2\)</span>. For problems dealing with our solar system, timescales of orbits can be described between months and hundreds of years, so measuring time in years is safe. We can also measure distance in astronomical units - Pluto is only 39 AU from the sun on average, so we can comfortably go to 100 AU and not push the limits of too many decades in magnitude.</p>
<p>The velocity of a circular orbit is given by Newton’s equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{m v^2}{r} = F_r = \frac{GMm}{r^2} \\
v^2 r = GM
\end{split}\]</div>
<p>The Earth’s orbit is roughly circular, and it orbits <span class="math notranslate nohighlight">\(2\pi \times 1AU\)</span> every year.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
4 \pi^2 \frac{\text{AU}^2}{1 \text{yr}^2} \times 1 \text{AU} = GM \\
GM = 4 \pi^2 \frac{\text{AU}^3}{\text{yr}^2} \equiv k
\end{split}\]</div>
</div>
<div class="section" id="earth">
<h2>Earth<a class="headerlink" href="#earth" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyPlanet</span> <span class="o">=</span> <span class="n">Earth</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Orbits</span><span class="p">(</span><span class="n">planet</span><span class="o">=</span><span class="n">MyPlanet</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MyPlanet</span><span class="p">(),</span> <span class="s2">&quot;period&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Earth&#39;s Orbit&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">points</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[::</span><span class="n">frames</span><span class="p">])):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">frames</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="halley-s-comet">
<h2>Halley’s Comet<a class="headerlink" href="#halley-s-comet" title="Permalink to this headline">¶</a></h2>
<p>We can check this for Halley’s Comet for a more complicated example. The period should be about 76 years.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyPlanet</span> <span class="o">=</span> <span class="n">HalleysComet</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Orbits</span><span class="p">(</span><span class="n">planet</span><span class="o">=</span><span class="n">MyPlanet</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MyPlanet</span><span class="p">(),</span> <span class="s2">&quot;period&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">points</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[::</span><span class="n">frames</span><span class="p">])):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">frames</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Halley&#39;s Comet, T=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> years&quot;</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="mercury">
<h1>Mercury<a class="headerlink" href="#mercury" title="Permalink to this headline">¶</a></h1>
<p>Here I’ll take a look at Mercury, which has a noticeable eccentricity, though less extreme than Halley’s Comet. In the real world, this orbit precesses, but in simulation it will not. Why the difference?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyPlanet</span> <span class="o">=</span> <span class="n">Mercury</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Orbits</span><span class="p">(</span><span class="n">planet</span><span class="o">=</span><span class="n">MyPlanet</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MyPlanet</span><span class="p">(),</span> <span class="s2">&quot;period&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mercury&#39;s Orbit&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">points</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[::</span><span class="n">frames</span><span class="p">])):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">frames</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="deviation-from-1-r-2">
<h2>Deviation from <span class="math notranslate nohighlight">\(1/r^2\)</span><a class="headerlink" href="#deviation-from-1-r-2" title="Permalink to this headline">¶</a></h2>
<p>In our universe, there are more gravitating bodies than just the sun and Mercury. The contributions to the gravitational force from these other bodies act as a perturbation on Mercury’s orbit and cause it to precess. One way of roughly modelling this is by slightly deviating from the <span class="math notranslate nohighlight">\(1/r^2\)</span> force.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyPlanet</span> <span class="o">=</span> <span class="n">Mercury</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Orbits</span><span class="p">(</span>
    <span class="n">planet</span><span class="o">=</span><span class="n">MyPlanet</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MyPlanet</span><span class="p">(),</span> <span class="s2">&quot;period&quot;</span><span class="p">),</span> <span class="n">exponent</span><span class="o">=</span><span class="mf">2.2</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;Mercury&#39;s Orbit, $\beta$=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">exponent</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">points</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[::</span><span class="n">frames</span><span class="p">])):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">frames</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="p-s-matplotlib-animatefunc">
<h1>P.S. - Matplotlib AnimateFunc<a class="headerlink" href="#p-s-matplotlib-animatefunc" title="Permalink to this headline">¶</a></h1>
<p>The animated plots above look a lot nicer outside of Jupyter notebooks, when using Matplotlib’s <code class="docutils literal notranslate"><span class="pre">AnimateFunc</span></code>. Try running one through a terminal!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">notebook</span>

<span class="n">MyPlanet</span> <span class="o">=</span> <span class="n">HalleysComet</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Orbits</span><span class="p">(</span><span class="n">planet</span><span class="o">=</span><span class="n">MyPlanet</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">Tmax</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MyPlanet</span><span class="p">(),</span> <span class="s2">&quot;period&quot;</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># can&#39;t change this while blitting</span>
<span class="p">(</span><span class="n">line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="n">points</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span> <span class="o">*</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Black&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Init data for plot functions.&quot;&quot;&quot;</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">points</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (AU)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Halley&#39;s Comet orbit, T=76 years&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set data for plot functions while looping over index i.&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">points</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;time=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> years</span><span class="se">\n</span><span class="s2">energy=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">Es</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;KE=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">KEs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">PE=</span><span class="si">{</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">Es</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="o">.</span><span class="n">KEs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>


<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ts</span><span class="p">),</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

</pre></div>
</div>
<p>Note that these <code class="docutils literal notranslate"><span class="pre">Matplotlib.FuncAnimation</span></code> plots work much better outside of Jupyter notebooks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Equations of motion</a><ul>
<li><a class="reference internal" href="#lagrangian">Lagrangian</a></li>
</ul>
</li>
<li><a class="reference internal" href="#effective-potential">Effective potential</a></li>
<li><a class="reference internal" href="#d-central-potential-scattering">1D Central Potential Scattering</a><ul>
<li><a class="reference internal" href="#elliptic-integral-gratis">Elliptic integral gratis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gravitational-orbits-code">Gravitational Orbits Code</a><ul>
<li><a class="reference internal" href="#define-celestial-objects">Define celestial objects</a></li>
<li><a class="reference internal" href="#units">units</a></li>
<li><a class="reference internal" href="#earth">Earth</a></li>
<li><a class="reference internal" href="#halley-s-comet">Halley’s Comet</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mercury">Mercury</a><ul>
<li><a class="reference internal" href="#deviation-from-1-r-2">Deviation from <span class="math notranslate nohighlight">\(1/r^2\)</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#p-s-matplotlib-animatefunc">P.S. - Matplotlib AnimateFunc</a></li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../Orbits.html"
                          title="previous chapter">Notebooks</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Perihelion%20shift%20of%20Mercury.html"
                          title="next chapter">Mercury</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Orbits/Keplerian Orbits.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Perihelion%20shift%20of%20Mercury.html" title="Mercury"
             >next</a> |</li>
        <li class="right" >
          <a href="../Orbits.html" title="Notebooks"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">kepler 0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../Orbits.html" >Notebooks</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Equations of motion</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Ryan AC.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>